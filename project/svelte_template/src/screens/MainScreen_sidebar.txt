<!-- ÏÇ¨Ïù¥ÎìúÎ∞î nav Î∂ÄÎ∂Ñ -->
<nav class="flex-grow overflow-y-auto px-2 space-y-1 custom-scrollbar">
    {#if sidebarTab === "chats"}
        {#each filteredChats as chat (chat.id)}
            <div class="relative group">
                <button
                    class="w-full text-left rounded-lg p-3 pr-12 text-sm hover:bg-[#333] transition-colors {sessionId ===
                    chat.id
                        ? 'bg-[#333]'
                        : ''}"
                    on:click={() => loadChat(chat)}
                >
                    <div class="font-medium text-white truncate">
                        {chat.title}
                    </div>
                    <div class="text-xs text-gray-400 mt-1">
                        {formatDate(chat.timestamp)}
                    </div>
                </button>
                <div
                    class="absolute right-0 top-0 bottom-0 flex items-center"
                >
                    <button
                        class="w-12 h-full flex items-center justify-center md:opacity-0 md:group-hover:opacity-100 hover:bg-red-500/20 transition-all rounded-r-lg"
                        on:click={(e) => deleteChat(chat.id, e)}
                        title="ÏÇ≠Ï†ú"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-5 w-5 text-red-500"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                        >
                            <path
                                fill-rule="evenodd"
                                d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                clip-rule="evenodd"
                            />
                        </svg>
                    </button>
                </div>
            </div>
        {/each}
    {:else}
        {#each filteredFavorites as item (item.type === "bookmark" ? item.data.id : item.data.id)}
            {#if item.type === "bookmark"}
                <div class="relative group">
                    <button
                        class="w-full text-left rounded-lg p-3 pr-12 text-sm hover:bg-[#333] transition-colors flex items-start gap-2"
                        on:click={() => loadChat(item.data)}
                    >
                        <span
                            class="text-yellow-400 text-sm flex-shrink-0"
                            >üìå</span
                        >
                        <div class="flex-1 min-w-0">
                            <div
                                class="font-medium text-white truncate"
                            >
                                {item.data.title}
                            </div>
                            <div class="text-xs text-gray-400 mt-1">
                                {formatDate(item.data.timestamp)}
                            </div>
                        </div>
                    </button>
                    <div
                        class="absolute right-0 top-0 bottom-0 flex items-center"
                    >
                        <button
                            class="w-12 h-full flex items-center justify-center md:opacity-0 md:group-hover:opacity-100 hover:bg-red-500/20 transition-all rounded-r-lg"
                            on:click={(e) => deleteBookmark(item.data.id, e)}
                            title="Î∂ÅÎßàÌÅ¨ Ìï¥Ï†ú"
                        >
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                class="h-5 w-5 text-red-500"
                                viewBox="0 0 20 20"
                                fill="currentColor"
                            >
                                <path
                                    fill-rule="evenodd"
                                    d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                    clip-rule="evenodd"
                                />
                            </svg>
                        </button>
                    </div>
                </div>
            {:else}
                {@const chat = chatHistory.find(
                    (c) => c.id === item.data.threadId,
                )}
                {@const messageCards = chat?.messages?.find(
                    (m, idx) => {
                        const parts = item.data.id.split("-");
                        const messageIdx = parseInt(
                            parts[parts.length - 2],
                        );
                        return idx === messageIdx;
                    },
                )?.cards}
                <div class="relative group">
                    <button
                        class="w-full text-left rounded-lg p-3 pr-12 text-sm hover:bg-[#333] transition-colors flex items-start gap-2"
                        on:click={() => loadLikedCard(item.data)}
                    >
                        <span class="text-red-400 text-sm flex-shrink-0"
                            >‚ù§Ô∏è</span
                        >
                        <div class="flex-1 min-w-0">
                            <div
                                class="font-medium text-white truncate"
                            >
                                {getCardDisplayTitle(
                                    item.data.card,
                                    messageCards,
                                )}
                            </div>
                            <div class="text-xs text-gray-400 mt-1">
                                {formatDate(item.data.timestamp)}
                            </div>
                        </div>
                    </button>
                    <div
                        class="absolute right-0 top-0 bottom-0 flex items-center"
                    >
                        <button
                            class="w-12 h-full flex items-center justify-center md:opacity-0 md:group-hover:opacity-100 hover:bg-red-500/20 transition-all rounded-r-lg"
                            on:click={(e) => deleteLike(item.data.id, e)}
                            title="Ï¢ãÏïÑÏöî Ìï¥Ï†ú"
                        >
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                class="h-5 w-5 text-red-500"
                                viewBox="0 0 20 20"
                                fill="currentColor"
                            >
                                <path
                                    fill-rule="evenodd"
                                    d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                    clip-rule="evenodd"
                                />
                            </svg>
                        </button>
                    </div>
                </div>
            {/if}
        {/each}
    {/if}
</nav>